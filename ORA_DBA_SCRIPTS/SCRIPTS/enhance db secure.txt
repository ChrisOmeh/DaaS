CREATE OR REPLACE TRIGGER SYS.block_unmapped_systems
AFTER LOGON ON DATABASE
DECLARE
OSUSER VARCHAR2(50);
SESSIONUSER VARCHAR2(50);
HOSTNAME VARCHAR2(100);
HOSTIP VARCHAR2(50);

BEGIN
   select sys_context ('USERENV', 'OS_USER') into OSUSER from dual   ;
   select sys_context ('USERENV', 'HOST') into HOSTNAME from dual ;
   SELECT sys_context('USERENV','SESSION_USER') INTO SESSIONUSER FROM DUAL  ;
   SELECT sys_context('USERENV','SESSION_USER') INTO HOST_IP  FROM DUAL  ;
  SELECT STATUS FROM SYS.UNBLOCKED_SYSTEMS_TBL 
  WHERE UPPER(OS_USER)=UPPER(OSUSER)
  AND UPPER(DB_USER)=UPPER(SESSIONUSER)
  AND UPPER(HOST_NAME)=UPPER(HOSTNAME)
  AND HOST_IP=  HOSTIP;
  If STATUS <> 1
  then
   raise_application_error(-20001,'Denied!  You are not allowed to logon from host '||HOSTNAME|| ' with IP Address'||HOST_IP || ' using '|| OSUSER);
   INSERT INTO SYS.FAILED_LOGON_SYSTEMS_TBL (OS_USER,DB_USER,HOST_NAME,HOST_IP,Logon_date) VALUES (OSUSER,SESSIONUSER,HOSTNAME,HOSTIP,SYSDATE);
   COMMIT;
 END IF
END;






